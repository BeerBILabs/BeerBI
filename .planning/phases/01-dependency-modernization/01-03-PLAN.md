---
phase: 01-dependency-modernization
plan: 03
type: execute
wave: 2
depends_on:
  - 01-01
  - 01-02
files_modified:
  - docker/backend/Dockerfile
  - docker/frontend/Dockerfile
  - docker/frontend/Dockerfile.dev
autonomous: true

must_haves:
  truths:
    - "Backend Docker image uses Alpine 3.23"
    - "Frontend Docker images use Bun 1.3.7"
    - "All Docker containers build successfully"
    - "Health checks pass on built containers"
  artifacts:
    - path: "docker/backend/Dockerfile"
      provides: "Backend container definition"
      contains: "alpine:3.23"
    - path: "docker/frontend/Dockerfile"
      provides: "Frontend production container"
      contains: "oven/bun:1.3.7"
    - path: "docker/frontend/Dockerfile.dev"
      provides: "Frontend development container"
      contains: "oven/bun:1.3.7"
  key_links:
    - from: "docker/backend/Dockerfile"
      to: "Alpine base image"
      via: "FROM directive"
      pattern: "FROM alpine:3\\.23"
    - from: "docker/frontend/Dockerfile"
      to: "Bun base image"
      via: "FROM directive"
      pattern: "FROM oven/bun:1\\.3\\.7"
---

<objective>
Update Docker base images: Alpine 3.23 for backend, Bun 1.3.7 for frontend

Purpose: Complete the dependency modernization by updating container base images. Alpine 3.23 brings apk v3 and latest security patches. Pinning Bun to 1.3.7 satisfies the DEP-03 requirement explicitly.

Output: Updated Dockerfiles with new base images, verified container builds
</objective>

<execution_context>
@/home/tdolfen/.claude/get-shit-done/workflows/execute-plan.md
@/home/tdolfen/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-dependency-modernization/01-RESEARCH.md

# Source files
@docker/backend/Dockerfile
@docker/frontend/Dockerfile
@docker/frontend/Dockerfile.dev
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update backend Dockerfile to Alpine 3.23</name>
  <files>docker/backend/Dockerfile</files>
  <action>
Edit `docker/backend/Dockerfile` and change ONLY the final stage base image:

**Before (line 19):**
```dockerfile
FROM alpine:3.20
```

**After:**
```dockerfile
FROM alpine:3.23
```

DO NOT change:
- The builder stage (`golang:1.25-alpine`) -- it already resolves to Alpine 3.23.3 + Go 1.25.6
- Any other lines in the file
- The apk commands (syntax unchanged in apk v3)

Use minor version tag `3.23` (not `3.23.3`) so Docker pulls latest patch automatically.
  </action>
  <verify>
```bash
grep "FROM alpine:3.23" docker/backend/Dockerfile
```
  </verify>
  <done>docker/backend/Dockerfile contains "FROM alpine:3.23"</done>
</task>

<task type="auto">
  <name>Task 2: Update frontend Dockerfiles to Bun 1.3.7</name>
  <files>docker/frontend/Dockerfile, docker/frontend/Dockerfile.dev</files>
  <action>
Edit both frontend Dockerfiles to pin Bun to version 1.3.7:

**docker/frontend/Dockerfile (line 3):**
```dockerfile
# Before:
FROM oven/bun:1 AS base

# After:
FROM oven/bun:1.3.7 AS base
```

**docker/frontend/Dockerfile.dev (line 1):**
```dockerfile
# Before:
FROM oven/bun:latest AS deps

# After:
FROM oven/bun:1.3.7 AS deps
```

This pins Bun to exactly 1.3.7 to satisfy the DEP-03 requirement. Both Dockerfiles use the same Bun version for consistency between dev and production.
  </action>
  <verify>
```bash
grep "FROM oven/bun:1.3.7" docker/frontend/Dockerfile
grep "FROM oven/bun:1.3.7" docker/frontend/Dockerfile.dev
```
  </verify>
  <done>Both frontend Dockerfiles contain "FROM oven/bun:1.3.7"</done>
</task>

<task type="auto">
  <name>Task 3: Verify Docker images build successfully</name>
  <files>docker/</files>
  <action>
Build all Docker images to verify the base image updates work correctly:

```bash
cd /home/tdolfen/Projects/github.com/BeerBILabs

# Build backend image
docker build -t beerbot-backend:test -f docker/backend/Dockerfile backend/bot/

# Build frontend production image
docker build -t beerbot-frontend:test -f docker/frontend/Dockerfile frontend/project/
```

Both builds should complete without errors. The frontend build may show the @next/swc warning during the `bun run build` step -- this is expected and acceptable.

Note: We build images but do not run them (would require environment variables and Slack tokens). The build verification is sufficient to confirm base images work.
  </action>
  <verify>
```bash
docker images | grep beerbot-backend | grep test
docker images | grep beerbot-frontend | grep test
```
  </verify>
  <done>Both Docker images built successfully and appear in docker images list</done>
</task>

</tasks>

<verification>
After completing all tasks:

1. `docker/backend/Dockerfile` contains `FROM alpine:3.23`
2. `docker/frontend/Dockerfile` contains `FROM oven/bun:1.3.7`
3. `docker/frontend/Dockerfile.dev` contains `FROM oven/bun:1.3.7`
4. Backend Docker image builds successfully
5. Frontend Docker image builds successfully

DEP-03 (Bun runtime updated to 1.3.7) and DEP-04 (Docker images use Alpine 3.23) will be satisfied.
</verification>

<success_criteria>
- Alpine 3.23 is the backend runtime base
- Bun 1.3.7 is pinned in all frontend Dockerfiles
- All container builds succeed
- No regressions in Dockerfile functionality
</success_criteria>

<output>
After completion, create `.planning/phases/01-dependency-modernization/01-03-SUMMARY.md`
</output>
