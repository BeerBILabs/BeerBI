---
phase: 02-beer-branded-theming
plan: 03
type: execute
wave: 3
depends_on: [02-01, 02-02]
files_modified:
  - frontend/project/components/ThemeToggle.tsx
autonomous: false

must_haves:
  truths:
    - "User can see theme toggle control in the header"
    - "Tooltip appears on hover showing 'Switch to dark/light mode'"
    - "Theme switches immediately when toggle is clicked"
    - "Toggle icon animates smoothly when switching"
    - "Toggle styling is consistent in both themes"
  artifacts:
    - path: "frontend/project/components/ThemeToggle.tsx"
      provides: "Theme toggle with tooltip and animation"
      exports: ["default"]
  key_links:
    - from: "ThemeToggle.tsx"
      to: "ThemeProvider.tsx useTheme"
      via: "hook import"
      pattern: "useTheme.*from.*ThemeProvider"
---

<objective>
Enhance the theme toggle with a tooltip and improved styling, then verify the complete theming system works.

Purpose: Completes the user-facing theming experience with polish (tooltip, animation) and validates all requirements through human verification. Satisfies THEME-01 (toggle visible), THEME-07 (consistent button styling).

Output: Enhanced ThemeToggle.tsx with tooltip and animation, plus verified working theming system.
</objective>

<execution_context>
@/home/tdolfen/.claude/get-shit-done/workflows/execute-plan.md
@/home/tdolfen/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-beer-branded-theming/02-CONTEXT.md
@.planning/phases/02-beer-branded-theming/02-RESEARCH.md

@frontend/project/components/ThemeToggle.tsx
@frontend/project/components/ThemeProvider.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add tooltip and enhance styling on ThemeToggle</name>
  <files>frontend/project/components/ThemeToggle.tsx</files>
  <action>
Update ThemeToggle.tsx to add:
1. Tooltip on hover showing "Switch to dark mode" / "Switch to light mode"
2. Smooth icon transition/animation when theme changes
3. Consistent styling that works in both themes using CSS variables

```typescript
"use client"

import { useEffect, useState } from 'react'
import { Sun, Moon } from 'lucide-react'
import { useTheme } from './ThemeProvider'

export default function ThemeToggle() {
  const { toggleTheme, getTheme } = useTheme()
  const [isDark, setIsDark] = useState(false)
  const [showTooltip, setShowTooltip] = useState(false)
  const [mounted, setMounted] = useState(false)

  useEffect(() => {
    setMounted(true)
    setIsDark(getTheme() === 'dark')
  }, [getTheme])

  function onClick() {
    toggleTheme()
    setIsDark((v) => !v)
  }

  // Don't render toggle until mounted to avoid hydration mismatch
  if (!mounted) {
    return (
      <div className="ml-4 w-[72px] h-[32px]" aria-hidden="true" />
    )
  }

  const tooltipText = isDark ? 'Switch to light mode' : 'Switch to dark mode'

  return (
    <div className="relative ml-4">
      <button
        type="button"
        onClick={onClick}
        onMouseEnter={() => setShowTooltip(true)}
        onMouseLeave={() => setShowTooltip(false)}
        onFocus={() => setShowTooltip(true)}
        onBlur={() => setShowTooltip(false)}
        aria-label={tooltipText}
        className="inline-flex items-center justify-center gap-2 rounded-md px-3 py-1.5 text-sm font-medium cursor-pointer border transition-colors duration-200"
        style={{
          backgroundColor: 'hsl(var(--card))',
          color: 'hsl(var(--card-foreground))',
          borderColor: 'hsl(var(--border))',
        }}
      >
        <span
          className="relative w-4 h-4 transition-transform duration-200"
          style={{ transform: isDark ? 'rotate(0deg)' : 'rotate(180deg)' }}
        >
          {isDark ? (
            <Sun size={16} className="absolute inset-0" />
          ) : (
            <Moon size={16} className="absolute inset-0" />
          )}
        </span>
      </button>

      {/* Tooltip */}
      {showTooltip && (
        <div
          role="tooltip"
          className="absolute left-1/2 -translate-x-1/2 bottom-full mb-2 px-2 py-1 text-xs rounded whitespace-nowrap pointer-events-none z-50 transition-opacity duration-150"
          style={{
            backgroundColor: 'hsl(var(--popover))',
            color: 'hsl(var(--popover-foreground))',
            border: '1px solid hsl(var(--border))',
            boxShadow: '0 2px 4px rgba(0,0,0,0.1)',
          }}
        >
          {tooltipText}
          {/* Tooltip arrow */}
          <div
            className="absolute left-1/2 -translate-x-1/2 top-full w-0 h-0"
            style={{
              borderLeft: '4px solid transparent',
              borderRight: '4px solid transparent',
              borderTop: '4px solid hsl(var(--border))',
            }}
          />
        </div>
      )}
    </div>
  )
}
```

Key changes from original:
- Added showTooltip state for hover/focus tooltip
- Added mounted state to prevent hydration mismatch (placeholder until mounted)
- Tooltip appears above button with arrow pointing down
- Icon has subtle rotation animation (180deg) when toggling
- Uses CSS variables for styling (works in both themes)
- Tooltip shows on both hover and focus (keyboard accessible)
- Added border to button for better visibility
- Role="tooltip" for accessibility
  </action>
  <verify>
Check tooltip state: `grep "showTooltip" frontend/project/components/ThemeToggle.tsx`
Check rotation animation: `grep "rotate" frontend/project/components/ThemeToggle.tsx`
Check role tooltip: `grep 'role="tooltip"' frontend/project/components/ThemeToggle.tsx`
  </verify>
  <done>
ThemeToggle has tooltip on hover/focus, icon rotation animation, and consistent styling using CSS variables.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete beer-branded theming system:
1. Beer-themed color palette (warm amber light mode, stout brown dark mode)
2. Cookie-based theme persistence (replaces localStorage)
3. Server-side theme rendering (no FOUC)
4. Smooth 250ms transitions when switching themes
5. Theme toggle with tooltip and animation
  </what-built>
  <how-to-verify>
Start the development server and verify the complete theming system:

```bash
cd frontend/project && npm run dev
```

Then test in browser at http://localhost:3000 (or whatever port):

**1. Visual appearance (THEME-06):**
- [ ] Light mode: Background is warm off-white (slight yellow tint), not pure white
- [ ] Light mode: Accents are amber/gold colored
- [ ] Dark mode: Background is deep brown/black (stout-like)
- [ ] Dark mode: Accents are bright gold

**2. Toggle functionality (THEME-01, THEME-02):**
- [ ] Toggle button visible in header
- [ ] Click toggle: theme switches between light and dark
- [ ] Theme change is smooth (fades ~250ms, not instant snap)
- [ ] Icon rotates slightly when switching

**3. Tooltip (user decision):**
- [ ] Hover over toggle: tooltip appears saying "Switch to dark mode" or "Switch to light mode"
- [ ] Tooltip disappears when mouse leaves
- [ ] Tab to toggle: tooltip appears (keyboard accessible)

**4. Persistence (THEME-03):**
- [ ] Toggle to dark mode
- [ ] Hard refresh the page (Ctrl+Shift+R / Cmd+Shift+R)
- [ ] Page loads in dark mode (preference persisted)
- [ ] Toggle to light mode and refresh: loads in light mode

**5. No FOUC (THEME-05):**
- [ ] Set to dark mode, then hard refresh
- [ ] NO flash of light mode before dark mode appears
- [ ] (Brief flash is acceptable per user, but ideally none)

**6. First visit default (THEME-04 override):**
- [ ] Open in incognito/private window (no cookies)
- [ ] Page loads in LIGHT mode by default
- [ ] System preference is NOT detected (even if your OS is in dark mode)

**7. Button consistency (THEME-07):**
- [ ] Toggle button looks good in light mode (visible, proper contrast)
- [ ] Toggle button looks good in dark mode (visible, proper contrast)
- [ ] Button border is visible in both modes

If any issues, describe what's wrong. Type "approved" if all checks pass.
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Pre-checkpoint automated checks:

1. Build: `cd frontend/project && npm run build` passes
2. TypeScript: `cd frontend/project && npx tsc --noEmit` passes
3. Dev server starts: `cd frontend/project && npm run dev` runs without errors

Human verification covers:
- All 7 THEME requirements
- Visual appearance of beer colors
- Functional theme switching
- Persistence and FOUC prevention
</verification>

<success_criteria>
- ThemeToggle.tsx has tooltip functionality
- ThemeToggle.tsx has icon animation
- Build and type check pass
- Human verification approves all THEME requirements:
  - THEME-01: Toggle visible
  - THEME-02: Light/dark switching works
  - THEME-03: Cookie persistence works
  - THEME-04 override: Defaults to light (not system preference)
  - THEME-05: No FOUC (or acceptable brief flash)
  - THEME-06: Beer colors applied
  - THEME-07: Button consistent in both themes
</success_criteria>

<output>
After completion, create `.planning/phases/02-beer-branded-theming/02-03-SUMMARY.md`
</output>
