---
phase: 03-quarterly-rankings
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/project/lib/quarters.ts
  - frontend/project/app/rankings/page.tsx
  - frontend/project/app/rankings/all/page.tsx
  - frontend/project/app/rankings/[year]/[quarter]/page.tsx
  - frontend/project/app/rankings/layout.tsx
autonomous: true

must_haves:
  truths:
    - "Navigating to /rankings redirects to current quarter URL"
    - "Navigating to /rankings/all shows all-time page shell"
    - "Navigating to /rankings/2026/q1 shows quarterly page shell"
    - "Invalid year/quarter URLs return 404"
  artifacts:
    - path: "frontend/project/lib/quarters.ts"
      provides: "Quarter date calculation utilities"
      exports: ["getQuarterDates", "getCurrentQuarter", "getPreviousQuarter", "isValidQuarter"]
    - path: "frontend/project/app/rankings/page.tsx"
      provides: "Redirect to current quarter"
      contains: "redirect("
    - path: "frontend/project/app/rankings/all/page.tsx"
      provides: "All-time rankings page shell"
      contains: "All Time"
    - path: "frontend/project/app/rankings/[year]/[quarter]/page.tsx"
      provides: "Quarterly rankings page with param validation"
      contains: "await params"
    - path: "frontend/project/app/rankings/layout.tsx"
      provides: "Shared layout for rankings pages"
      contains: "children"
  key_links:
    - from: "frontend/project/app/rankings/page.tsx"
      to: "frontend/project/lib/quarters.ts"
      via: "import getCurrentQuarter"
      pattern: "getCurrentQuarter"
    - from: "frontend/project/app/rankings/[year]/[quarter]/page.tsx"
      to: "frontend/project/lib/quarters.ts"
      via: "import isValidQuarter"
      pattern: "isValidQuarter"
---

<objective>
Establish the route foundation for quarterly rankings: utility functions for quarter calculations and Next.js App Router structure with proper validation.

Purpose: Create the URL structure that enables shareable links (QRANK-05) and lays groundwork for navigation (QRANK-01).

Output: Working routes at /rankings (redirect), /rankings/all (shell), /rankings/YYYY/qN (shell with validation), plus quarter utility library.
</objective>

<execution_context>
@/home/tdolfen/.claude/get-shit-done/workflows/execute-plan.md
@/home/tdolfen/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-quarterly-rankings/03-CONTEXT.md
@.planning/phases/03-quarterly-rankings/03-RESEARCH.md
@frontend/project/app/layout.tsx
@frontend/project/app/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create quarter utility functions</name>
  <files>frontend/project/lib/quarters.ts</files>
  <action>
Create a new lib/quarters.ts file with pure TypeScript utility functions:

1. `getQuarterDates(year: number, quarter: number): { start: string; end: string }` - Returns ISO date strings for quarter start/end. Q1=Jan-Mar, Q2=Apr-Jun, Q3=Jul-Sep, Q4=Oct-Dec. Use `new Date(year, startMonth, 1)` for start, `new Date(year, startMonth + 3, 0)` for last day of quarter.

2. `getCurrentQuarter(): { year: number; quarter: number }` - Returns current year and quarter (1-4). Quarter = `Math.ceil((month + 1) / 3)`.

3. `getPreviousQuarter(year: number, quarter: number): { year: number; quarter: number }` - Returns previous quarter with year wrap (Q1 2026 -> Q4 2025).

4. `isValidQuarter(year: number, quarter: number): boolean` - Returns true if quarter is 1-4 and year is reasonable (2020-2099). Also returns false if quarter is in the future (after current quarter).

5. `formatQuarterLabel(quarter: number): string` - Returns "Q1", "Q2", etc.

Export all functions. No external dependencies - use native Date APIs only.
  </action>
  <verify>
Run: `cd /home/tdolfen/Projects/github.com/BeerBILabs/frontend/project && npx tsc --noEmit lib/quarters.ts`
TypeScript compiles without errors.
  </verify>
  <done>All 5 utility functions exist, are type-safe, and handle edge cases (year wrap, future quarters).</done>
</task>

<task type="auto">
  <name>Task 2: Create rankings route structure with redirect and shells</name>
  <files>
    frontend/project/app/rankings/page.tsx
    frontend/project/app/rankings/all/page.tsx
    frontend/project/app/rankings/[year]/[quarter]/page.tsx
    frontend/project/app/rankings/layout.tsx
  </files>
  <action>
Create the Next.js App Router structure for rankings:

**rankings/page.tsx** (Server Component):
- Import `redirect` from 'next/navigation' and `getCurrentQuarter` from lib/quarters
- Calculate current quarter and redirect to `/rankings/${year}/q${quarter}`
- No UI needed - just the redirect

**rankings/all/page.tsx** (Server Component):
- Simple shell page with "All Time Rankings" heading
- Use beer-themed styling: `style={{ color: 'hsl(var(--primary))' }}`
- Placeholder text: "All-time leaderboard coming soon..."
- Export metadata with title "All Time Rankings | BeerBot"

**rankings/[year]/[quarter]/page.tsx** (Server Component):
- Next.js 15 params are Promise: `params: Promise<{ year: string; quarter: string }>`
- Await params: `const { year, quarter } = await params`
- Validate: year is 4-digit number (2020-2099), quarter matches /^q[1-4]$/i
- Use `isValidQuarter` to check not in future
- If invalid, call `notFound()` from 'next/navigation'
- Render shell with "Q{N} {Year} Rankings" heading
- Placeholder text: "Quarterly leaderboard coming soon..."
- Export `generateMetadata` for dynamic title

**rankings/layout.tsx** (Server Component):
- Accept `children` prop
- Wrap in a container div with placeholder for navigation (will be added in Plan 02)
- Comment: `{/* Tab navigation will be added in Plan 02 */}`
- Return children wrapped in semantic structure
  </action>
  <verify>
1. `curl -I http://localhost:3000/rankings` returns 307 redirect to current quarter
2. `curl http://localhost:3000/rankings/all` returns 200 with "All Time"
3. `curl http://localhost:3000/rankings/2026/q1` returns 200 with "Q1 2026"
4. `curl -I http://localhost:3000/rankings/2099/q4` returns 404 (future)
5. `curl -I http://localhost:3000/rankings/2026/q5` returns 404 (invalid quarter)
  </verify>
  <done>Route structure exists with working redirect, param validation, 404 for invalid URLs, and shell pages for all-time and quarterly views.</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `cd /home/tdolfen/Projects/github.com/BeerBILabs/frontend/project && npm run build` succeeds
2. Dev server running, manually test:
   - /rankings -> redirects to /rankings/YYYY/qN (current)
   - /rankings/all -> shows all-time shell
   - /rankings/2026/q1 -> shows Q1 2026 shell
   - /rankings/1999/q1 -> 404 (year out of range)
   - /rankings/2030/q1 -> 404 (future)
</verification>

<success_criteria>
- Quarter utilities library exists at lib/quarters.ts with all 5 functions
- Route structure handles /rankings, /rankings/all, /rankings/YYYY/qN
- Invalid URLs (bad year, bad quarter, future quarter) return 404
- All pages use beer-themed CSS variables for consistency
- Build passes without TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-quarterly-rankings/03-01-SUMMARY.md`
</output>
